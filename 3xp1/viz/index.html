<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Collatz Reverse Steps Visualizer</title>
    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            color: #1f2937;
            margin: 0;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            margin-bottom: 1rem;
            font-weight: 700;
        }

        input[type="number"] {
            width: 120px;
            font-size: 2rem;
            padding: 0.3rem 0.5rem;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            text-align: center;
            outline-offset: 2px;
            margin-bottom: 2rem;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            border-color: #2563eb;
        }

        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100px;
        }

        .step-box {
            background: #3b82f6;
            color: white;
            font-weight: 700;
            font-size: 1.8rem;
            padding: 0.6rem 0;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(59, 130, 246, 0.4);
            user-select: none;
            transition: background-color 0.3s;
        }

        .step-box:hover {
            background: #2563eb;
        }

        @media (max-width: 400px) {
            input[type="number"] {
                width: 90px;
                font-size: 1.6rem;
            }

            .steps-container {
                width: 80px;
            }

            .step-box {
                font-size: 1.4rem;
                padding: 0.5rem 0;
            }
        }
    </style>
</head>

<body>

    <h1>Collatz Reverse Steps</h1>
    <input id="startNumber" type="number" min="1" step="1" value="7" aria-label="Starting number" />

    <div id="steps" class="steps-container" aria-live="polite" aria-atomic="true"></div>

    <script>
        function collatzSequence(n) {
            const seq = [n];
            while (n !== 1) {
                if (n % 2 === 0) {
                    n = n / 2;
                } else {
                    n = 3 * n + 1;
                }
                seq.push(n);
            }
            return seq;
        }

        function buildReverseGroups(start) {
            const seq = collatzSequence(start);
            const seqSet = new Set(seq); // For O(1) lookups
            // Extract odd numbers in the Collatz sequence
            const odds = seq.filter(x => x % 2 === 1);
            const groups = [];
            odds.forEach(oddNum => {
                let chainLength = 1;
                let val = oddNum;
                // Double val until doubled value not in seq
                while (seqSet.has(val * 2)) {
                    val = val * 2;
                    chainLength++;
                }
                groups.push(chainLength - 1); // steps = chain length minus 1
            });
            // Sort descending by step count
            groups.sort((a, b) => b - a);
            return groups;
        }
        const startInput = document.getElementById('startNumber');
        const stepsContainer = document.getElementById('steps');

        function renderSteps(start) {
            stepsContainer.innerHTML = '';
            if (!start || start < 1 || !Number.isInteger(start)) {
                stepsContainer.innerHTML = '<p>Please enter a positive integer.</p>';
                return;
            }
            const stepsArray = buildReverseGroups(start);
            stepsArray.forEach(steps => {
                const box = document.createElement('div');
                box.className = 'step-box';
                box.textContent = steps;
                stepsContainer.appendChild(box);
            });
        }
        renderSteps(Number(startInput.value));
        startInput.addEventListener('input', () => {
            const val = Number(startInput.value);
            renderSteps(val);
        });
    </script>

</body>

</html>